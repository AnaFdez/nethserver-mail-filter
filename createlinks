#!/usr/bin/perl -w

use strict;
use esmith::Build::CreateLinks qw(:all);


my @templates = qw(
    /etc/amavisd.conf
    /etc/postfix/main.cf
    /etc/postfix/master.cf
    /etc/cron.d/sa-update
    /etc/postfix/virtual
    /etc/sudoers
);

#
# nethserver-mail-filter-UPDATE event
#

event_templates('nethserver-mail-filter-update', @templates);

event_actions('nethserver-mail-filter-update',
	      'initialize-default-databases' => '00',
	      'nethserver-mail-filter-conf' => '20',	      
	      'firewall-adjust' => '40',
	      'runlevel-adjust' => '50');

event_services('nethserver-mail-filter-update',
	       'postgrey' => 'restart',
	       'amavisd' => 'restart',
	       'postfix' => 'restart');

#
# nethserver-mail-filter-SAVE event
#

event_templates('nethserver-mail-filter-save', qw(
    /etc/amavisd.conf
    /etc/postfix/main.cf
    /etc/postfix/master.cf
    /etc/postfix/virtual
));

event_services('nethserver-mail-filter-save',
               'postfix' => 'reload',

               # FIXME: reload support is added in amavisd-new >= 2.7. Check for updates
	       'amavisd' => 'restart',

	       'postgrey' => 'reload',
); 

#
# nethserver-mail-filter-UNINSTALL event
#
event_actions('nethserver-mail-filter-uninstall',
	      'nethserver-mail-filter-uninstall' => '02',
	      'firewall-adjust' => '40',
	      'runlevel-adjust' => '50');

